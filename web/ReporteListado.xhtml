<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<f:view>
    <f:metadata>
        <f:viewAction action="#{sessionBean.verificarAcceso('madre_comunitaria')}" />
    </f:metadata>

    <h:head>
        <title>ICBF Conecta - Reportes de Matrículas</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <h:outputStylesheet library="css" name="estilos.css"/>
        <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"/>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
    </h:head>

    <h:body styleClass="dashboard-body" style="background-image: url(#{resource['img/fondito.png']});">

        <header>
            <img src="#{resource['img/logoSinFondo.png']}" alt="Logo del Software"/>
            <nav>
                <ul>
                    <li><h:link outcome="listarNinos" value=" Matrículas"><i class="fas fa-user-graduate"></i></h:link></li>
                    <li><h:link outcome="planeaciones" value=" Planeaciones"><i class="fas fa-book"></i></h:link></li>
                    <li><h:link outcome="desarrollo" value=" Desarrollo"><i class="fas fa-child"></i></h:link></li>
                    <li><h:link outcome="correos" value=" Enviar Correos"><i class="fas fa-envelope"></i></h:link></li>
                    <li>
                        <h:form>
                            <h:commandLink action="#{loginBean.logout}">
                                <i class="fas fa-sign-out-alt"></i> Cerrar sesión
                            </h:commandLink>
                        </h:form>
                    </li>
                </ul>
            </nav>
        </header>

        <div class="main-title">
            ICBF - CONECTA | Reportes de Matrículas <br/>
            Bienvenida, <h:outputText value="#{sessionBean.usuarioLogueado.nombres}"/>
        </div>

        <div class="page-wrapper">
            <div class="page-header-block">
                <h1 class="page-title">Reportes disponibles</h1>
                <p class="page-description">Consulta los listados para revisar o descargar la información completa de cada niño.</p>
            </div>

            <h:form id="formReportes">
                <div class="table-card">
                    <p:dataTable value="#{reporteBean.listaReportes}" var="r" paginator="true" rows="10"
                                 emptyMessage="No hay reportes disponibles"
                                 styleClass="tabla-modern">

                        <p:column headerText="Niño">
                            <h:outputText value="#{r.ninoNombres} #{r.ninoApellidos}" />
                        </p:column>

                        <p:column headerText="Documento">
                            <h:outputText value="#{r.ninoDocumento}" />
                        </p:column>

                        <p:column headerText="Acudiente">
                            <h:outputText value="#{r.padreNombres} #{r.padreApellidos}" />
                        </p:column>

                        <p:column headerText="Detalle" style="text-align:center; width:150px;">
                            <p:commandButton value="Ver detalle"
                                             action="#{reporteBean.verDetalle(r.idNino)}"
                                             ajax="false"
                                             styleClass="btn-outline"/>
                        </p:column>

                        <p:column headerText="Reporte PDF" style="text-align:center; width:160px;">
                            <h:outputLink value="#{facesContext.externalContext.requestContextPath}/ReporteNinoPdfServlet?id=#{r.idNino}" target="_blank">
                                <i class="pi pi-file-pdf" style="margin-right:4px"></i>
                                <h:outputText value="Descargar" />
                            </h:outputLink>
                        </p:column>

                    </p:dataTable>
                </div>

                <div class="action-bar">
                    <p:commandButton value="Volver a matrículas"
                                     action="listarNinos?faces-redirect=true"
                                     icon="pi pi-arrow-left"
                                     ajax="false"
                                     styleClass="btn-outline" />

                    <p:commandButton value="Ir al dashboard"
                                     action="madreDashboard?faces-redirect=true"
                                     icon="pi pi-home"
                                     ajax="false"
                                     styleClass="btn-secondary" />
                </div>
            </h:form>
        </div>

    </h:body>
</f:view>
</html>
