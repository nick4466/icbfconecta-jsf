<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
    <title>Listado de Niños</title>
</h:head>
<h:body>

    <!-- ID explícito al form -->
    <h:form id="formNinos">
        <h2>Niños Matriculados en Mi Hogar</h2>

        <!-- Mensajes globales -->
        <p:messages id="mensajes" showDetail="true" showSummary="true" />

        <!-- Tabla con PrimeFaces -->
        <p:dataTable id="tablaNinos"
                     value="#{ninoBean.listaNinos}" var="n"
                     paginator="true" rows="10"
                     emptyMessage="No hay niños matriculados en este hogar"
                     scrollable="true" scrollHeight="400">

            <!-- Columnas -->
            <p:column headerText="ID">
                <h:outputText value="#{n.idNino}" />
            </p:column>

            <p:column headerText="Nombres">
                <h:outputText value="#{n.nombres}" />
            </p:column>

            <p:column headerText="Apellidos">
                <h:outputText value="#{n.apellidos}" />
            </p:column>

            <p:column headerText="Documento">
                <h:outputText value="#{n.documento}" />
            </p:column>

            <p:column headerText="Fecha Nacimiento">
                <h:outputText value="#{n.fechaNacimiento}" />
            </p:column>

            <p:column headerText="Género">
                <h:outputText value="#{n.genero}" />
            </p:column>

            <p:column headerText="Nacionalidad">
                <h:outputText value="#{n.nacionalidad}" />
            </p:column>

            <!-- Archivos subidos -->
            <p:column headerText="Foto">
                <h:outputLink value="#{n.foto}" target="_blank">Ver Foto</h:outputLink>
            </p:column>

            <p:column headerText="Carnet Vacunación">
                <h:outputLink value="#{n.carnetVacunacion}" target="_blank">Ver Carnet</h:outputLink>
            </p:column>

            <p:column headerText="Certificado EPS">
                <h:outputLink value="#{n.certificadoEps}" target="_blank">Ver Certificado</h:outputLink>
            </p:column>

            <!-- Acciones -->
            <p:column headerText="Acciones">
                <!-- Editar -->
                <p:commandButton value="Editar"
                                 action="editarNino?faces-redirect=true"
                                 update="formNinos:mensajes">
                    <f:setPropertyActionListener value="#{n}" target="#{ninoBean.nino}" />
                </p:commandButton>

                <!-- Eliminar -->
                <p:commandButton value="Eliminar"
                                 actionListener="#{ninoBean.eliminar(n.idNino)}"
                                 update="formNinos:mensajes formNinos:tablaNinos"
                                 process="@this"
                                 onclick="return confirm('¿Seguro que deseas eliminar este niño?');"/>
            </p:column>

        </p:dataTable>

        <br/>

        <!-- Botones de navegación -->
        <p:commandButton value="Registrar Nuevo Niño"
                         action="crearNino?faces-redirect=true"
                         ajax="false" />

        <p:commandButton value="Volver al Dashboard"
                         action="madreDashboard?faces-redirect=true"
                         ajax="false" />

        <p:commandButton value="Ver Reporte de Niños"
                         action="ReporteListado?faces-redirect=true"
                         icon="pi pi-list"
                         ajax="false" />
    </h:form>

</h:body>
</html>
