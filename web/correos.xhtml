<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<f:view>
    <f:metadata>
        <f:viewAction action="#{sessionBean.verificarAcceso('madre_comunitaria')}" />
    </f:metadata>

    <h:head>
        <title>ICBF Conecta - Listado de Niños</title>
        <h:outputStylesheet library="css" name="estilos.css"/>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"/>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
        <style>
            body {
                margin: 0;
                font-family: 'Roboto', sans-serif;
                background-image: url("#{resource['img/fondito.png']}");
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                background-attachment: fixed;
            }
            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background-color: rgba(255,255,255,0.9);
                padding: 10px 20px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            header img {
                height: 50px;
            }
            nav ul {
                list-style: none;
                margin: 0;
                padding: 0;
                display: flex;
                gap: 15px;
            }
            nav ul li {
                display: inline;
            }
            nav ul li a, nav ul li h\\:commandLink {
                text-decoration: none;
                color: #5e3370;
                font-weight: bold;
                transition: color 0.3s;
            }
            nav ul li a:hover, nav ul li h\\:commandLink:hover {
                color: #9B59B6;
            }
            .main-title {
                text-align: center;
                font-size: 22px;
                font-weight: bold;
                color: #5e3370;
                margin: 20px 0;
            }
            .contenedor {
                width: 90%;
                margin: 0 auto;
            }
            .form-panel {
                background-color: rgba(255,255,255,0.95);
                padding: 20px;
                border-radius: 12px;
                margin-bottom: 25px;
                box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            }
            .form-panel h3 {
                color: #9B59B6;
                margin-bottom: 15px;
                text-align: center;
            }
            .tabla-cabecera {
                background-color: #f0e6fa !important;
                color: #4b0082 !important;
                font-weight: bold;
                text-align: center;
            }
            .foto-rectangular {
                width: 80px;
                height: 100px;
                object-fit: cover;
                border: 2px solid #d9b3ff;
                border-radius: 6px;
            }
            .botones-navegacion {
                text-align: center;
                margin-top: 20px;
            }
            .botones-navegacion .ui-button {
                margin: 5px;
                background: linear-gradient(135deg, #f3c1e5, #e8a9d6) !important;
                border: none !important;
                color: #5e3370 !important;
                font-weight: bold;
                border-radius: 8px;
                transition: all 0.3s ease;
            }
            .botones-navegacion .ui-button:hover {
                background: linear-gradient(135deg, #e8a9d6, #d988bc) !important;
                transform: translateY(-2px);
            }
        </style>
    </h:head>

    <h:body>

        <!-- HEADER -->
        <header>
            <img src="#{resource['img/logoSinFondo.png']}" alt="Logo ICBF Conecta"/>
            <nav>
                <ul>
                    <li><h:link outcome="listarNinos" value=" Matrículas"><i class="fas fa-user-graduate"></i></h:link></li>
                    <li><h:link outcome="planeaciones" value=" Planeaciones"><i class="fas fa-book"></i></h:link></li>
                    <li><h:link outcome="desarrollo" value=" Desarrollo"><i class="fas fa-child"></i></h:link></li>
                    <li><h:link outcome="correos" value=" Enviar Correos"><i class="fas fa-envelope"></i></h:link></li>
                    <li>
                        <h:form>
                            <h:commandLink action="#{loginBean.logout}">
                                <i class="fas fa-sign-out-alt"></i> Cerrar sesión
                            </h:commandLink>
                        </h:form>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- TÍTULO -->
        <div class="main-title">
            ICBF - CONECTA | Listado de Niños <br/>
            Bienvenida, <h:outputText value="#{sessionBean.usuarioLogueado.nombres}"/>
        </div>

        <!-- CONTENIDO -->
        <div class="contenedor">
            <h:form id="formNinos">

                <p:messages id="mensajes" showDetail="true" showSummary="true" closable="true" />

                <div class="form-panel">
                    <h3>Niños Matriculados en Mi Hogar</h3>

                    <p:dataTable id="tablaNinos"
                                 value="#{ninoBean.listaNinos}" var="n"
                                 paginator="true" rows="10"
                                 style="width:100%"
                                 emptyMessage="No hay niños matriculados en este hogar">

                        <p:column headerText="ID" styleClass="tabla-cabecera" style="width:60px; text-align:center;">
                            <h:outputText value="#{n.idNino}" />
                        </p:column>

                        <p:column headerText="Nombres" styleClass="tabla-cabecera">
                            <h:outputText value="#{n.nombres}" />
                        </p:column>

                        <p:column headerText="Apellidos" styleClass="tabla-cabecera">
                            <h:outputText value="#{n.apellidos}" />
                        </p:column>

                        <p:column headerText="Documento" styleClass="tabla-cabecera">
                            <h:outputText value="#{n.documento}" />
                        </p:column>

                        <p:column headerText="Fecha Nacimiento" styleClass="tabla-cabecera">
                            <h:outputText value="#{n.fechaNacimiento}">
                                <f:convertDateTime pattern="dd/MM/yyyy" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Género" styleClass="tabla-cabecera" style="text-align:center;">
                            <h:outputText value="#{n.genero}" />
                        </p:column>

                        <p:column headerText="Nacionalidad" styleClass="tabla-cabecera">
                            <h:outputText value="#{n.nacionalidad}" />
                        </p:column>

                        <p:column headerText="Foto" styleClass="tabla-cabecera" style="text-align:center; width:100px;">
                            <h:graphicImage value="http://localhost:8080/icbfconecta-jsf/uploads/#{n.foto}"
                                            styleClass="foto-rectangular"
                                            alt="Foto Niño"/>
                        </p:column>

                        <p:column headerText="Acciones" styleClass="tabla-cabecera" style="width:140px; text-align:center;">
                            <p:commandButton icon="pi pi-pencil" title="Editar"
                                             action="editarNino.xhtml"
                                             ajax="false"
                                             styleClass="acciones-btn">
                                <f:param name="idNino" value="#{n.idNino}" />
                            </p:commandButton>

                            <p:commandButton icon="pi pi-trash" title="Eliminar"
                                             styleClass="ui-button-danger acciones-btn"
                                             actionListener="#{ninoBean.eliminar(n.idNino)}"
                                             update="formNinos:mensajes formNinos:tablaNinos"
                                             process="@this"
                                             onclick="return confirm('¿Seguro que deseas eliminar este niño?');"/>
                        </p:column>
                    </p:dataTable>
                </div>

                <!-- Botones de navegación -->
                <div class="botones-navegacion">
                    <p:commandButton value="Registrar Nuevo Niño"
                                     action="crearNino?faces-redirect=true"
                                     icon="pi pi-plus"
                                     ajax="false" />

                    <p:commandButton value="Reporte de Niños"
                                     action="ReporteListado?faces-redirect=true"
                                     icon="pi pi-file"
                                     ajax="false" />

                    <p:commandButton value="Volver al Dashboard"
                                     action="madreDashboard?faces-redirect=true"
                                     icon="pi pi-home"
                                     ajax="false" />
                </div>

            </h:form>
        </div>

    </h:body>
</f:view>
</html>
